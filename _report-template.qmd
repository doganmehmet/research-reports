
```{python}
#| echo: false
#| include: false
# import libraries
import pandas_datareader.data as web
import pandas as pd
import yfinance as yf
from datetime import date

import matplotlib.pyplot as plt
import matplotlib.dates as mdates
import matplotlib.ticker as mticker
from matplotlib.ticker import FuncFormatter, PercentFormatter, MultipleLocator
```

```{python}
#| echo: false
#| include: false
# IMPORT ALL DATA SETS

# MSCI World Equity Index
msci = yf.download("^990100-USD-STRD", start="1900-01-01", interval="1mo", auto_adjust=True)['Close']
msci.rename(columns={"^990100-USD-STRD":"msci"}, inplace=True)
msci.index = msci.index.to_period('M')


#### Inflation
# monthly YoY US inflation
# https://fred.stlouisfed.org/series/CPIAUCSL
# https://tradingeconomics.com/united-states/inflation-cpi

inflation = web.get_data_fred(["CPIAUCSL", "CPILFESL"], start="1900-01-01")
inflation.rename(columns= {"CPIAUCSL":"cpi", "CPILFESL":"core_cpi"}, inplace=True)
inflation = inflation.pct_change(12)*100
inflation = inflation.round(1)
inflation.index = inflation.index.to_period('M')


# GDP (Real)
# https://fred.stlouisfed.org/series/GDPC1
    # compounded annual rate of change: [t/t(-1)]^4 -1  
# https://www.bea.gov/data/gdp/gross-domestic-product

gdp = web.get_data_fred("GDPC1", start="1900-01-01")
gdp.rename(columns= {"GDPC1":"gdp"}, inplace=True)

gdp = ((gdp / gdp.shift(1))**4 - 1)*100
gdp.dropna(inplace=True)
gdp.index = gdp.index.to_period('Q')
gdp = gdp.round(1)

# Household debt
#  Household Debt Service Payments as a Percent of Disposable Personal Income (TDSP)
#  Seasonally adjusted
hdebt = web.get_data_fred("TDSP", start = "1900-01-01")
hdebt.index = hdebt.index.to_period('Q')


# UNEMPLOYMENT
# https://fred.stlouisfed.org/series/UNRATE
unemployment = web.get_data_fred("UNRATE", start = "1900-01-01")
unemployment.index = unemployment.index.to_period('M')


# FED B/S Assets
# https://fred.stlouisfed.org/series/WALCL#
# frequency monthly, aggregation method: Average

# Download WALCL directly from FRED
fed_assets = web.get_data_fred("WALCL", start="1900-01-01")
fed_assets = fed_assets.resample('M').mean()

fed_assets.index = fed_assets.index.to_period('M')

# SP500, Nasdaq 100, Dow Jones  
tickers = ["^GSPC", "^NDX", "^DJI"]
stock_data = yf.download(tickers, start="1900-01-01", interval="1mo", auto_adjust=True)['Close']
stock_data.index = stock_data.index.to_period('M').to_timestamp('M') # the last index value should ideally be adjusted to today or some last business day
stock_data.rename(columns= {"^GSPC":"SP500",
                                "^NDX":"NDX",
                                "^DJI": "DJI"}, inplace=True)


# SP500 P/E Ratio
def fetch_multpl_pe_by_month():
    url = "https://www.multpl.com/s-p-500-pe-ratio/table/by-month"
    tables = pd.read_html(url)
    df = tables[0]
    df.columns = ["date", "pe"]
    
    # Clean PE column: remove non-numeric characters
    df["pe"] = df["pe"].astype(str).str.replace(r"[^0-9\.\-]", "", regex=True)
    df["pe"] = pd.to_numeric(df["pe"], errors="coerce")
    
    # Convert Date to datetime
    df["date"] = pd.to_datetime(df["date"])
    df["YearMonth"] = df["date"].dt.to_period("M")
    df = df.sort_values("date").drop_duplicates("YearMonth", keep="last")
    
    # Drop helper column
    df = df.drop(columns=["YearMonth"]).reset_index(drop=True)
    
    
    return df

pe = fetch_multpl_pe_by_month()

pe = pe.set_index("date")
pe.index = pe.index.to_period('M')

# VIX: CBOE volatility index
vix = yf.download("^VIX", start="1900-01-01", interval="1d", auto_adjust=True)['Close']
vix = vix.resample('M').mean()
vix.index = vix.index.to_period('M')
vix.rename(columns= {"^VIX":"VIX"}, inplace=True)

# FED TARGET RATE
# https://fred.stlouisfed.org/series/DFEDTARU
fedTargetRate = web.get_data_fred('DFEDTARU', start="2008-12-16")
fedTargetRate.rename(columns={'DFEDTARU':'fed_target_rate'}, inplace=True)
fedTargetRate['change'] = fedTargetRate['fed_target_rate'].diff()
fedTargetRate.dropna(inplace=True)
fedTargetRateChange = fedTargetRate[fedTargetRate['change'] != 0]


# US 2Y vs 10Y yields
# Get 2Y and 10Y Treasury Yields from FRED
usYields = web.get_data_fred(["DGS2", "DGS10"], start="1976-06-01")
usYields = usYields.dropna()

usYields_monthly = usYields.resample('M').mean()

# usYields["SR-LR"] = usYields["DGS2"] - usYields["DGS10"]

usYields_monthly.index = usYields_monthly.index.to_period('M')
# usYields_monthly["SR-LR"] = usYields_monthly["DGS2"] - usYields_monthly["DGS10"]


# U.S. Recessions
# https://fred.stlouisfed.org/series/JHDUSRGDPBR
recessions = web.get_data_fred("JHDUSRGDPBR", start="1900-01-01")
recessions.rename(columns={"JHDUSRGDPBR": "recession"}, inplace=True)
recessions.index = recessions.index.to_period('Q')

# Convert each dataframe to its own JSON string
# orient='records' creates a clean list of objects
# indent=2 adds nice formatting for readability
# monthly_msci_json = monthly_msci.to_json(orient='records', indent=2)
# inflation_json = inflation.to_json(orient='records', indent=2)
# gdp_json = gdp.to_json(orient='records', indent=2)
# stock_data_monthly_json = stock_data_monthly.to_json(orient='records', indent=2)
# fed_assets_json = fed_assets.to_json(orient='records', indent=2)
# hdebt_json = hdebt.to_json(orient='records', indent=2)

# we convert the index when creating dictionary
all_data = {
    "inflation": {str(k): v for k, v in inflation.to_dict(orient="index").items()},
    "unemployment": {str(k): v for k, v in unemployment.to_dict(orient="index").items()},
    "gdp": {str(k): v for k, v in gdp.to_dict(orient="index").items()},
    "fed_assets": {str(k): v for k, v in fed_assets.to_dict(orient="index").items()},
    "household_debt": {str(k): v for k, v in hdebt.to_dict(orient="index").items()},
    "msci": {str(k): v for k, v in msci.to_dict(orient="index").items()},
    "us_equities": {str(k): v for k, v in stock_data.to_dict(orient="index").items()},
    "sp500_pe": {str(k): v for k, v in pe.to_dict(orient="index").items()},
    "vix": {str(k): v for k, v in vix.to_dict(orient="index").items()},
    "us_recessions": {str(k): v for k, v in recessions.to_dict(orient="index").items()},
    "fed_target_rate": {str(k): v for k, v in fedTargetRateChange.to_dict(orient="index").items()},
    "us_yields": {str(k): v for k, v in usYields_monthly.to_dict(orient="index").items()}
}

```



```{python}
#| echo: false

import json
today = today = date.today().strftime("%B %d, %Y")


# --- BUILD THE PROMPT ---
# Use an f-string to inject both JSON strings into your prompt template.
prompt = f"""
First, provide a brief, up-to-date summary of the global financial markets covering the last three months up to today, {today}. When writing the summary, pay attention to indicators and trends that could suggest similarities to past U.S. market cycles. Focus on global equities, major stock indices, and global yields. When providing figures, prioritize the most recent month and year-to-date figures, if available. Limit the global summary to 3â€“5 sentences. The majority of the report should focus on the U.S. growth stock market.

Then, adopting the persona of a US growth-stock investor, use that summary as context for a deeper analysis of the U.S. market. Base your analysis *only* on the data provided in the JSON object below. In your analysis, please:

- Compare the current U.S. market and macroeconomic data to historical periods using the datasets provided (inflation, unemployment, GDP, FED balance sheet, household debt, equity indices, P/E ratios, VIX, yields, and recession indicators). Identify patterns, correlations, or cycles that resemble today.
- For each resemblance to past "boom and bust" periods, briefly explain why this similarity is relevant to current U.S. growth stocks. Where possible, quantify the similarity (e.g., "Current 2Y/10Y yield spread of X% is similar to Y% in 2000").
- Provide at least 2 specific risks and 2 specific opportunities for U.S. growth investors, directly linking each to the patterns identified above.

Data provided:
- inflation: Inflation, YoY
- unemployment: Unemployment rate
- gdp: Gross Domestic Product, GDP, YoY
- fed_assets: FED Balance Sheet (Assets)
- household_debt: Household debt servicing
- msci: MSCI World Equity Index. Monthly, but the last value represents the most recent day
- us_equities: Major U.S. stock indices (SP500: SP500, NDX: Nasdaq 100, DJI: Dow Jones). Monthly, but the last value represents the most recent day
- sp500_pe: SP 500 P/E ratio, Monthly, but the last value represents the most recent day
- vix: VIX cboe volatility index
- us_recessions: Past U.S. recessions, 1: there was a recession at the corresponding date
- fed_target_rate: Federal Funds Target Range - Upper Limit, Percent, Daily. It tells what the upper limit is, and what was the change on a specific day.
- us_yields: (DGS2: U.S. 2Y and DGS10: U.S. 10Y yields.


{json.dumps(all_data, indent=2)}

You are writing this to growth (stock) investors, but sound natural as an individual writing a research report or blog. Write in smooth paragraphs for narrative flow. Only use bullet points for risks, opportunities, or portfolio recommendations. Assume the reader is financially literate; do not define basic terms. Do not start with of course, as an investment research analyst etc. Provide enough information as detailed. Use one main title at the beginning which is catchy and describing the situation as of today, {today}. Do not use titles and subtitles, but you can use bullet points as you see fit. Use standard markdown format. Do not say this/that dataset etc.

Include charts only where they meaningfully support the discussion. Do not place charts in the introduction. You may use multiple charts per major section if they add value, but avoid placing charts in consecutive paragraphs. Use chart placeholders exactly as listed in the library below. Do not repeat the same chart within a section. Prioritize charts that strengthen the key points and insights.

Chart placeholders must be used only from the provided placeholder library and must be written in the exact format [CHART: Description of Chart].

Chart Placeholder Library:
- [CHART: US Inflation Rate (YoY)]
- [CHART: US Inflation Rate CPI and PCE (YoY)]
- [CHART: US Unemployment Rate]
- [CHART: US GDP Growth Rate (YoY)]
- [CHART: Federal Reserve Total Assets]
- [CHART: Household Debt Service Payments]
- [CHART: MSCI World Equity Index]
- [CHART: Performance of Major US Stock Indices]
- [CHART: S&P 500 PE Ratio]
- [CHART: Cboe Volatility Index (VIX)]
- [CHART: US Recession Indicator]
- [CHART: Federal Funds Target Rate (Upper Limit)]
- [CHART: US 2Y and 10Y Treasury Yields and Spread]


Finally, based on your complete analysis, conclude with a suggested portfolio exposure for US growth stocks (e.g., 0-25%, 25-50%, 50-75%, 75-100%). Briefly justify your reasoning.
"""
```


```{python}
#| echo: false
#| output: 'asis'
#| cache: true
# from openai import OpenAI

# client = OpenAI()

# # Reliable financial/economic domains
# trusted_domains = [
#     "reuters.com",
#     "bloomberg.com",
#     "ft.com",
#     "wsj.com",
#     "federalreserve.gov",
#     "ecb.europa.eu",
#     "bis.org",
#     "imf.org",
#     "worldbank.org",
#     "oecd.org",
#     "sec.gov",
#     "spglobal.com",
#     "msci.com",
#     "morningstar.com",
#     "nasdaq.com",
#     "nyse.com"
# ]

# response = client.responses.create(
#     model="gpt-5",   # or "gbt-5" "gpt-4.1" if GPT-5 isnâ€™t enabled in your account yet
#     tools=[{
#             "type": "web_search",
#             "filters": {
#               "allowed_domains": trusted_domains
#             }
#           }],
#     input=[
#         {"role": "user", "content": prompt}
#     ],
# )

# ai_response_gbt5 = response.output_text

```


```{python}
#| echo: false
#| output: 'asis'
#| cache: true
#| 
from google import genai
from google.genai import types

# The client gets the API key from the environment variable `GEMINI_API_KEY`.
client = genai.Client()

grounding_tool = types.Tool(
    google_search=types.GoogleSearch()
)

config = types.GenerateContentConfig(
    tools=[grounding_tool]
)

response = client.models.generate_content(
    model="gemini-2.5-pro", 
    contents=prompt,
    config=config,
)
ai_response_gemini25 = response.text
```



```{python}
#| echo: false
#| fig-align: center
#| include: false

# MSCI World Equity Index

# 1. Create the plot AND capture the Axes object in the 'ax' variable
ax = msci.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

# 2. Move the y-axis ticks and label to the right side
ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")

# 2. ADD THIS LINE: Customize the grid
ax.grid(True, linestyle='--', color='lightgrey', linewidth=0.5)

# 3. Hide the top and left spines
ax.spines['top'].set_visible(False)
ax.spines['left'].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/MSCI World Equity Index.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# Set titles and labels
# plt.show()

```



```{python}
#| echo: false
#| fig-align: center
#| include: false

ax = stock_data[stock_data.index.year > 1986].plot(linewidth=0.5)
# Set titles and labels

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

ax.yaxis.set_label_position("right")
ax.yaxis.tick_right()

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/Performance of Major US Stock Indices.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()

```

```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

import pandas as pd
import matplotlib.pyplot as plt

import matplotlib.dates as mdates
import numpy as np

# --- 1. SETUP: Create Sample Data ---
# This sample data matches the structure of your FRED data.
# Replace this section with your actual 'usYields' DataFrame.

# --- 2. Filter the Data (like in ggplot) ---
plot_data = usYields[usYields.index >= "2020-01-01"]
plot_data["SR-LR"] = plot_data["DGS2"] - plot_data["DGS10"]

# --- 3. Create and Customize the Plot ---

# Create a figure and an axes object
fig, ax = plt.subplots()
fig.set_facecolor('#f5f5f5') # Set figure background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# Define the exact colors from your ggplot code
colors = {
    "2Y Yield": "#bee0ff", 
    "10Y Yield": "#0612f2",  
    "SR-LR": "#D3D3D3"
}

# Plot each line with specific colors, labels, and line widths
ax.plot(plot_data.index, plot_data['DGS2'], color=colors["2Y Yield"], linewidth=1, label='2Y Yield')
ax.plot(plot_data.index, plot_data['DGS10'], color=colors["10Y Yield"], linewidth=1, label='10Y Yield')
ax.plot(plot_data.index, plot_data['SR-LR'], color=colors["SR-LR"], linewidth=1, label='SR-LR')

# Add the horizontal dashed line at y=0
ax.axhline(y=0, color='#D3D3D3', linestyle='--', linewidth=1.0)

# --- 4. FORMAT THE PLOT to match the theme ---
# --- ADDITIONS FOR MID-YEAR GRIDLINES ---
# 1. Set the location of minor ticks to be every 6 months
ax.xaxis.set_minor_locator(mdates.MonthLocator(bymonth=7))

# 2. Turn on the grid for the minor ticks and style them
ax.grid(True, which='minor', axis='x', linestyle='dotted', color='grey', linewidth=0.2)
# --- END ADDITIONS ---

# Customize the grid to be dotted
ax.grid(True, which='major', axis='y', linestyle='dotted', color='grey', linewidth=0.2)
ax.grid(True, which='major', axis='x', linestyle='dotted', color='grey', linewidth=0.2)

# Move the Y-axis to the right side and format as percentage
ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")
ax.yaxis.set_major_formatter(mticker.PercentFormatter(xmax=100.0, decimals=1))
ax.set_ylim(-2, 6)

# Format the X-axis to show years
ax.xaxis.set_major_locator(mdates.YearLocator())
ax.xaxis.set_major_formatter(mdates.DateFormatter('%Y'))
ax.tick_params(axis='x', labelsize=8)
ax.tick_params(axis='y', labelsize=8)

# --- ADD THIS LINE TO STYLE THE X-AXIS AND Y-AXIS TICKS ---
ax.tick_params(axis='x', which='major', direction='in', color='black', length=6, labelsize=8)
ax.tick_params(axis='y', which='major', direction='in', color='black', length=6, labelsize=8)

# Remove the plot frame lines (spines)
ax.spines[['top', 'left', 'bottom']].set_visible(False)

ax.spines['right'].set_visible(True)
ax.spines['right'].set_color('black')
ax.spines['right'].set_linewidth(0.75)

# Add titles and caption, positioned to match ggplot's style
# plt.rcParams['font.family'] = 'Inter' # Set font family if available
# fig.suptitle('Short vs long rates', x=0.09, y=0.98, ha='left', fontsize=16, fontweight='bold')
# ax.set_title('10Y yield little changed from Mar level', loc='left', fontsize=12, pad=10)
fig.text(0.01, 0.04, 'Data source: FRED', ha='left', fontsize=7, fontweight='bold')

# Customize the legend to match ggplot's style
ax.legend(loc='upper left', frameon=False, ncol=3)

# --- MODIFIED LEGEND CODE ---
# Add columnspacing=1.0 to reduce the space between legend items
ax.legend(loc='upper left', frameon=False, ncol=3, columnspacing=0.8)
# -----------------------------

fig.subplots_adjust(left=0.08, right=0.92, top=0.9, bottom=0.2)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/US 2Y and 10Y Treasury Yields and Spread.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)
# plt.show()

# To save the figure with the exact dimensions
# fig.savefig('my_700x350_plot.png', dpi=dpi) # 
```


```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# INFLATION

plot_data = inflation.tail(13) 

def custom_date_formatter(x, pos):
    dt = mdates.num2date(x)  # convert number to datetime
    if dt.month == 1:  # show year only in January
        return dt.strftime("%b\n%Y")
    else:
        return dt.strftime("%b")



# --- Plot ---
fig, ax = plt.subplots()
bars = ax.bar(plot_data.index.to_timestamp(), plot_data['cpi'], color="royalblue", width=20)

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig.patch.set_facecolor("#f5f5f5")  # figure background

# Add value labels above bars
for bar, val in zip(bars, plot_data['cpi']):
    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.05,
            f"{val:.1f}", ha="center", va="bottom", fontsize=9)

# --- Title & subtitle ---
# plt.suptitle("CPI: 2.4% YoY (vs. 2.8% in Feb)",
#              fontsize=16, fontweight="bold", x=0.01, ha="left")
# plt.title("Core CPI: 2.8% YoY, the lowest level since 2011",
#           fontsize=12, loc="left")

ax.yaxis.set_label_position("right")
ax.yaxis.tick_right()

# --- Format x-axis (monthly ticks, rotated) ---
ax.xaxis.set_major_locator(mdates.MonthLocator(interval=1))
#ax.xaxis.set_major_formatter(mdates.DateFormatter("%b\n%Y"))
ax.xaxis.set_major_formatter(FuncFormatter(custom_date_formatter))
plt.xticks(rotation=0)
ax.set_xlim(plot_data.index.to_timestamp().min() - pd.Timedelta(days=15),
            plot_data.index.to_timestamp().max() + pd.Timedelta(days=15))


# --- Format y-axis ---
ax.set_ylim(0, 5)
ax.set_ylabel("%", fontsize=10)
ax.yaxis.set_major_formatter(lambda x, pos: f"{x:.1f}%")

# --- Gridlines ---
ax.grid(True, axis="y", linestyle="--", alpha=0.5)
ax.grid(False, axis="x")

# --- Remove top/right spines ---
for spine in ["top", "right", "left"]:
    ax.spines[spine].set_visible(False)

# --- Data source note ---
plt.figtext(0.01, -0.02, "Data source: BLS", ha="left", fontsize=9, fontweight="bold")

# plt.tight_layout()

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/US Inflation Rate (YoY).png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)
# plt.show()

```

```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# Inflation, cpi and core_cpi

plot_data = inflation[inflation.index >= "2020-01-01"]

ax = plot_data.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

ax.yaxis.set_label_position("right")
ax.yaxis.tick_right()

ax.yaxis.set_major_formatter(PercentFormatter(xmax=100))  # if values like 2.4 = 2.4%
ax.yaxis.set_major_locator(MultipleLocator(1))            # 1% steps
# ax.set_ylim(1, 5)  # adjust to your data range

# Add gridlines
ax.grid(which='major', linestyle='--', linewidth=0.7)

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/US Inflation Rate CPI and PCE (YoY).png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```


```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# UNEMPLOYMENT

plot_data = unemployment[unemployment.index >= "2020-01-01"]

ax = plot_data.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")
ax.yaxis.set_major_formatter(PercentFormatter(xmax=100))  # if values like 2.4 = 2.4%
ax.yaxis.set_major_locator(MultipleLocator(1))            # 1% steps
# ax.set_ylim(1, 5)  # adjust to your data range

# Add gridlines
ax.grid(which='major', linestyle='--', linewidth=0.7)

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/US Unemployment Rate.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```



```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# GDP

plot_data = gdp.tail(12)

ax = plot_data.plot(kind='bar')

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

# Get the container from the existing plot
bar_container = ax.containers[0]

# Add bar labels
ax.bar_label(bar_container)


ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")
ax.yaxis.set_major_formatter(PercentFormatter(xmax=100))  # if values like 2.4 = 2.4%
ax.yaxis.set_major_locator(MultipleLocator(1))            # 1% steps


# --- Remove top/right spines ---
for spine in ["top", "left", "right"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/US GDP Growth Rate (YoY).png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```



```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# Federal Reserve Total Assets

ax = fed_assets.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")
formatter = FuncFormatter(lambda x, _: f'{x/1e6:.1f}T')
ax.yaxis.set_major_formatter(formatter)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/Federal Reserve Total Assets.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```



```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# Household Debt Service Payments

ax = hdebt.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

# # Get the container from the existing plot
# bar_container = ax.containers[0]

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)


ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")

# formatter = FuncFormatter(lambda x, _: f'{x/1e6:.1f}T')
# ax.yaxis.set_major_formatter(formatter)

ax.yaxis.set_major_formatter(PercentFormatter(xmax=100))  # if values like 2.4 = 2.4%


plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/Household Debt Service Payments.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```


```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# S&P 500 P/E Ratio

ax = pe.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/S&P 500 PE Ratio.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```



```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# Cboe Volatility Index (VIX)

ax = vix.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/Cboe Volatility Index (VIX).png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```



```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# Federal Funds Target Rate (Upper Limit)

ax = fedTargetRate.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

# # Get the container from the existing plot
# bar_container = ax.containers[0]

# # Add bar labels
# ax.bar_label(bar_container)


ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")

# formatter = FuncFormatter(lambda x, _: f'{x/1e6:.1f}T')
# ax.yaxis.set_major_formatter(formatter)


ax.yaxis.set_major_formatter(PercentFormatter(xmax=100))  # if values like 2.4 = 2.4%
# ax.yaxis.set_major_locator(MultipleLocator(1))            # 1% steps
# ax.set_ylim(1, 5)  # adjust to your data range

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/Federal Funds Target Rate (Upper Limit).png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```



```{python}
#| echo: false
#| fig-align: center
#| fig-width: 7
#| fig-height: 3.5
#| fig-dpi: 100
#| include: false

# US Recession Indicator

ax = recessions.plot()

# setting figure background and plot background color
ax.set_facecolor('#f5f5f5')  # Set plot background color

# To access the figure:
fig = ax.get_figure()
fig.patch.set_facecolor("#f5f5f5")  # figure background

# # Get the container from the existing plot
# bar_container = ax.containers[0]

# # Add bar labels
# ax.bar_label(bar_container)


ax.yaxis.tick_right()
ax.yaxis.set_label_position("right")

# --- Remove top/right spines ---
for spine in ["top", "left"]:
    ax.spines[spine].set_visible(False)

plt.savefig(
    'C:/Users/Mehmet/OneDrive/Investment/Market Research/charts/US Recession Indicator.png', # Filename and extension
    dpi=300,             # Dots per inch for high resolution
    bbox_inches='tight'  # Trims extra whitespace
)

# plt.show()
```

# OPEANAI GBT-5
```{python}
#| echo: false
#| output: 'asis'

### AUTOMATION OF CHART PLACEMENT

# import re
# # The base path to your charts folder
# base_path = "charts/"

# # The dictionary mapping the placeholder description to the full file path of each chart
# CHART_FILENAME_LIBRARY = {
#     "US Inflation Rate (YoY)": base_path + "US Inflation Rate (YoY).png",
#     "US Inflation Rate CPI and PCE (YoY)": base_path + "US Inflation Rate CPI and PCE (YoY).png",
#     "US Unemployment Rate": base_path + "US Unemployment Rate.png",
#     "US GDP Growth Rate (YoY)": base_path + "US GDP Growth Rate (YoY).png",
#     "Federal Reserve Total Assets": base_path + "Federal Reserve Total Assets.png",
#     "Household Debt Service Payments": base_path + "Household Debt Service Payments.png",
#     "MSCI World Equity Index": base_path + "MSCI World Equity Index.png",
#     "Performance of Major US Stock Indices": base_path + "Performance of Major US Stock Indices.png",
#     "S&P 500 PE Ratio": base_path + "S&P 500 PE Ratio.png",
#     "Cboe Volatility Index (VIX)": base_path + "Cboe Volatility Index (VIX).png",
#     "US Recession Indicator": base_path + "US Recession Indicator.png",
#     "Federal Funds Target Rate (Upper Limit)": base_path + "Federal Funds Target Rate (Upper Limit).png",
#     "US 2Y and 10Y Treasury Yields and Spread": base_path + "US 2Y and 10Y Treasury Yields and Spread.png"
# }

# # The text from the Gemini API
# ai_response_text = ai_response_gbt5

# segments = re.split(r'(\[CHART:.*?\])', ai_response_text)

# for segment in segments:
#     if segment.startswith('[CHART:'):
#         chart_description = segment[7:-1].strip()
        
#         # Look up the filename in your new library
#         chart_filename = CHART_FILENAME_LIBRARY.get(chart_description)
        
#         if chart_filename:
#             # Print the markdown image tag using the found filename
#             print(f"\n![{chart_description}]({chart_filename})\n")
#         else:
#             print(f"\n_Warning: Chart '{chart_description}' not found in library._\n")
            
#     else:
#         # This is a normal text segment, so just print it
#         print(segment, end="")
```


# GEMINI 2.5-Pro
```{python}
#| echo: false
#| output: 'asis'

### AUTOMATION OF CHART PLACEMENT

import re
# The base path to your charts folder
base_path = "docs/charts/"

# The dictionary mapping the placeholder description to the full file path of each chart
CHART_FILENAME_LIBRARY = {
    "US Inflation Rate (YoY)": base_path + "US Inflation Rate (YoY).png",
    "US Inflation Rate CPI and PCE (YoY)": base_path + "US Inflation Rate CPI and PCE (YoY).png",
    "US Unemployment Rate": base_path + "US Unemployment Rate.png",
    "US GDP Growth Rate (YoY)": base_path + "US GDP Growth Rate (YoY).png",
    "Federal Reserve Total Assets": base_path + "Federal Reserve Total Assets.png",
    "Household Debt Service Payments": base_path + "Household Debt Service Payments.png",
    "MSCI World Equity Index": base_path + "MSCI World Equity Index.png",
    "Performance of Major US Stock Indices": base_path + "Performance of Major US Stock Indices.png",
    "S&P 500 PE Ratio": base_path + "S&P 500 PE Ratio.png",
    "Cboe Volatility Index (VIX)": base_path + "Cboe Volatility Index (VIX).png",
    "US Recession Indicator": base_path + "US Recession Indicator.png",
    "Federal Funds Target Rate (Upper Limit)": base_path + "Federal Funds Target Rate (Upper Limit).png",
    "US 2Y and 10Y Treasury Yields and Spread": base_path + "US 2Y and 10Y Treasury Yields and Spread.png"
}

# The text from the Gemini API
ai_response_text = ai_response_gemini25

segments = re.split(r'(\[CHART:.*?\])', ai_response_text)

for segment in segments:
    if segment.startswith('[CHART:'):
        chart_description = segment[7:-1].strip()
        
        # Look up the filename in your new library
        chart_filename = CHART_FILENAME_LIBRARY.get(chart_description)
        
        if chart_filename:
            # Print the markdown image tag using the found filename
            print(f"\n![{chart_description}]({chart_filename})\n")
        else:
            print(f"\n_Warning: Chart '{chart_description}' not found in library._\n")
            
    else:
        # This is a normal text segment, so just print it
        print(segment, end="")
```


```{python}
#| echo: false
#| output: 'asis'
#| cache: true

# import datetime

# # --- 1. Generate the dynamic date string ---
# today = datetime.date.today()
# day = today.day

# if 1 <= day <= 10:
#     part_of_month = "early"
# elif 11 <= day <= 20:
#     part_of_month = "mid"
# else:
#     part_of_month = "late"

# # Format the final string (e.g., "late September 2025")
# date_string = f"as of {part_of_month} {today.strftime('%B %Y')}"


# # --- 2. Build your prompt using the dynamic date ---
# prompt = f"""
# Using your web search capabilities, identify 10 US growth stocks that are currently trending in financial news and analyst reports {date_string}.

# For each stock, provide:
# 1. The company name and ticker symbol.
# 2. A brief, one-sentence summary of why it is considered a trending growth stock.
# 3. Please cite your sources.

# Use only one title "Trending Stocks".

# Present all results in a markdown table with columns: Company Name, Ticker Symbol, Summary. Include a header row. Do not use any other format such as plain lists or paragraphs.
# Use bold for company names, plain text for ticker symbols, and concise sentences for the summary. Keep the summary column clear and readable.

# """

# # Now the 'prompt' variable is ready to be sent to the Gemini API
# #print(prompt) # Uncomment to see the final prompt

# from google import genai
# from google.genai import types

# # The client gets the API key from the environment variable `GEMINI_API_KEY`.
# client = genai.Client()

# grounding_tool = types.Tool(
#     google_search=types.GoogleSearch()
# )

# config = types.GenerateContentConfig(
#     tools=[grounding_tool]
# )

# response = client.models.generate_content(
#     model="gemini-2.5-pro", 
#     contents=prompt,
#     config=config,
# )
# print(response.text)

```


```{python}
#| echo: false
#| output: 'asis'
#| cache: true
#| 
# from google import genai
# from google.genai import types

# # The client gets the API key from the environment variable `GEMINI_API_KEY`.
# client = genai.Client()

# grounding_tool = types.Tool(
#     google_search=types.GoogleSearch()
# )

# config = types.GenerateContentConfig(
#     tools=[grounding_tool]
# )

# response = client.models.generate_content(
#     model="gemini-2.5-pro", 
#     contents=f"""
#     1. Make a summary of the latest inflation report from BLS. Also make a commentary of what the current inflation reading may mean for a growth-stock investor.
#     2.  Make a summary of the latest GDP report from BAE. Also make a commentary of what the current inflation reading may mean for a growth-stock investor.

#     Do not start like this e.g., Washington D.C. - ... start with text directly.
#     """,
#     config=config,
# )
# print(response.text)
```

